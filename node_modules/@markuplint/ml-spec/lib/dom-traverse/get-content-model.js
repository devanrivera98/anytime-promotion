"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getContentModel = void 0;
const get_spec_1 = require("./get-spec");
const cachesBySpecs = new Map();
function getContentModel(
// eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types
el, specs) {
    var _a, _b;
    const cacheByEl = (_a = cachesBySpecs.get(specs)) !== null && _a !== void 0 ? _a : new Map();
    const cached = cacheByEl.get(el);
    if (cached !== undefined) {
        return cached;
    }
    const spec = (0, get_spec_1.getSpec)(el, specs);
    if (!spec) {
        cacheByEl.set(el, null);
        return null;
    }
    const conditions = (_b = spec.contentModel.conditional) !== null && _b !== void 0 ? _b : [];
    for (const cond of conditions) {
        if (el.matches(cond.condition)) {
            cacheByEl.set(el, cond.contents);
            return cond.contents;
        }
    }
    cacheByEl.set(el, spec.contentModel.contents);
    return spec.contentModel.contents;
}
exports.getContentModel = getContentModel;
