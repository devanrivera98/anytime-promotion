"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPermittedRoles = void 0;
const is_plain_object_1 = require("is-plain-object");
const merge_array_1 = require("../utils/merge-array");
const aria_specs_1 = require("./aria-specs");
const get_aria_1 = require("./get-aria");
/**
 * Getting permitted ARIA roles.
 *
 * - If an array, it is role list.
 * - If `true`, this mean is "Any".
 * - If `false`, this mean is "No".
 */
function getPermittedRoles(specs, localName, namespace, version, matches) {
    const aria = (0, get_aria_1.getARIA)(specs, localName, namespace, version, matches);
    if (!aria) {
        return [];
    }
    const { implicitRole, permittedRoles } = aria;
    const { roles, graphicsRoles } = (0, aria_specs_1.ariaSpecs)(specs, version);
    let permittedRoleList = [];
    if (permittedRoles === true) {
        permittedRoleList = (0, merge_array_1.mergeArray)(permittedRoleList, roles
            .filter(role => !role.isAbstract)
            .map(role => ({
            name: role.name,
        })));
    }
    if (isAAMInfo(permittedRoles)) {
        if (permittedRoles['core-aam']) {
            permittedRoleList = (0, merge_array_1.mergeArray)(permittedRoleList, roles
                .filter(role => !role.isAbstract)
                .map(role => ({
                name: role.name,
            })));
        }
        if (permittedRoles['graphics-aam']) {
            permittedRoleList = (0, merge_array_1.mergeArray)(permittedRoleList, graphicsRoles
                .filter(role => !role.isAbstract)
                .map(role => ({
                name: role.name,
            })));
        }
    }
    else if (typeof permittedRoles !== 'boolean') {
        permittedRoleList = (0, merge_array_1.mergeArray)(permittedRoleList, permittedRoles.map(role => {
            if (typeof role === 'string') {
                return {
                    name: role,
                };
            }
            return role;
        }));
    }
    if (implicitRole === false) {
        return permittedRoleList;
    }
    const implicitRoles = implicitRole === 'presentation' || implicitRole === 'none' ? ['none', 'presentation'] : [implicitRole];
    return (0, merge_array_1.mergeArray)(implicitRoles.map(r => ({ name: r })), permittedRoleList);
}
exports.getPermittedRoles = getPermittedRoles;
function isAAMInfo(permittedRoles) {
    return (0, is_plain_object_1.isPlainObject)(permittedRoles);
}
