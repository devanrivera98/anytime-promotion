"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.contentModelPseudoClass = void 0;
const ml_spec_1 = require("@markuplint/ml-spec");
const create_selector_1 = require("../create-selector");
function contentModelPseudoClass(specs) {
    return (category) => (
    // eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types
    el) => {
        category = category.trim().toLowerCase();
        const selectors = (0, ml_spec_1.contentModelCategoryToTagNames)(`#${category}`, specs.def);
        const matched = selectors
            .map(selector => {
            if (selector === '#custom') {
                // @ts-ignore
                if (el.isCustomElement) {
                    return [
                        {
                            specificity: [0, 1, 0],
                            matched: true,
                            nodes: [el],
                            has: [],
                        },
                    ];
                }
                return [
                    {
                        specificity: [0, 1, 0],
                        matched: false,
                    },
                ];
            }
            if (selector === '#text') {
                return [
                    {
                        specificity: [0, 1, 0],
                        matched: false,
                    },
                ];
            }
            return (0, create_selector_1.createSelector)(selector, specs).search(el);
        })
            .flat()
            .filter((m) => m.matched);
        if (matched.length > 0) {
            return {
                specificity: [0, 1, 0],
                matched: true,
                nodes: matched.map(m => (m.matched ? m.nodes : [])).flat(),
                has: matched.map(m => (m.matched ? m.has : [])).flat(),
            };
        }
        return {
            specificity: [0, 1, 0],
            matched: false,
        };
    };
}
exports.contentModelPseudoClass = contentModelPseudoClass;
