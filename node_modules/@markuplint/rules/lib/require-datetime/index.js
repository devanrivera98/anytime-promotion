"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ml_core_1 = require("@markuplint/ml-core");
const types_1 = require("@markuplint/types");
const utils_1 = require("./utils");
exports.default = (0, ml_core_1.createRule)({
    defaultOptions: {
        langs: undefined,
    },
    verify({ document, report, t }) {
        document.querySelectorAll('time:not([datetime])').forEach(time => {
            if (time.hasMutableChildren()) {
                return;
            }
            const content = time.textContent.trim();
            const result = (0, types_1.check)(content, 'DateTime');
            if (result.matched) {
                return;
            }
            const candidate = (0, utils_1.getCandidateDatetimeString)(content, time.rule.options.langs);
            if (candidate) {
                report({
                    scope: time,
                    message: t('need {0*}', `datetime="${candidate}"`),
                });
                return;
            }
            report({
                scope: time,
                message: t('need {0}', t('the "{0*}" {1}', 'datetime', 'attribute')),
            });
        });
    },
});
