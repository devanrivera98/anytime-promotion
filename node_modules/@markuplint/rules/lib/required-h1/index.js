"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ml_core_1 = require("@markuplint/ml-core");
exports.default = (0, ml_core_1.createRule)({
    defaultOptions: {
        'expected-once': true,
        'in-document-fragment': false,
    },
    async verify({ document, report, t }) {
        var _a, _b;
        const h1Stack = [];
        if (document.nodeList.length === 0) {
            return;
        }
        if (!document.rule.options['in-document-fragment'] && document.isFragment) {
            return;
        }
        await document.walkOn('Element', node => {
            if (node.nodeName.toLowerCase() === 'h1') {
                h1Stack.push(node);
            }
        });
        if (h1Stack.length === 0) {
            const message = t('Require {0}', t('the "{0*}" {1}', 'h1', 'element'));
            report({
                message,
                line: 1,
                col: 1,
                raw: (_b = (_a = document.nodeList[0]) === null || _a === void 0 ? void 0 : _a.raw.slice(0, 1)) !== null && _b !== void 0 ? _b : '',
            });
        }
        else if (document.rule.options['expected-once'] && h1Stack.length > 1 && h1Stack[1]) {
            const message = t('{0} is {1:c}', t('the "{0*}" {1}', 'h1', 'element'), 'duplicated');
            report({
                message,
                line: h1Stack[1].startLine,
                col: h1Stack[1].startCol,
                raw: h1Stack[1].raw,
            });
        }
    },
});
